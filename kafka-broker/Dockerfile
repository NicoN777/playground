FROM toastyboii/base-ol9-node:v0.0.1
EXPOSE 9092 19092
ARG KAFKA_USER=kafka
ARG KAFKA_USER_UID=1000
ARG KAFKA_USER_HOME=/home/$KAFKA_USER
ARG SCALA_VERSION=2.13
ARG KAFKA_VERSION=3.4.0
ENV KAFKA_LOG_DIRS=/var/kafka-logs
ENV KAFKA_HOME="${KAFKA_USER_HOME}/kafka_${SCALA_VERSION}-${KAFKA_VERSION}"
ENV PATH="${PATH}:${KAFKA_HOME}/bin"
COPY user.sh /tmp
RUN sh /tmp/user.sh $KAFKA_USER $KAFKA_USER_UID
USER $KAFKA_USER
WORKDIR $KAFKA_USER_HOME
COPY --chown=${KAFKA_USER_UID}:${KAFKA_USER_UID} install.sh $KAFKA_USER_HOME
RUN sh install.sh $SCALA_VERSION $KAFKA_VERSION
COPY --chown=${KAFKA_USER_UID}:${KAFKA_USER_UID} docker-entrypoint.sh ${KAFKA_USER_HOME}
RUN chmod -x docker-entrypoint.sh
ENTRYPOINT ["sh", "docker-entrypoint.sh"]

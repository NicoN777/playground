FROM python:3
ARG SCRIPT_NAME="kafka-admin-client.py"
ARG DOCKER_HOST_IP
ENV DOCKER_HOST_IP=$DOCKER_HOST_IP
ENV DESTINATION_APP_TARGET=/usr/src/app
ENV EXECUTABLE_SCRIPT=${DESTINATION_APP_TARGET}/${SCRIPT_NAME}
ENV TLS_DIR="${HOME}"/tls
ENV SSL_KEYSTORE_PASS="${SSL_KEYSTORE_PASS:-changeit}"
ENV SSL_KEY_PASS="${SSL_KEYSTORE_PASS:-changeit}"
ENV SSL_TRUSTSTORE_PASS="${SSL_TRUSTSTORE_PASS:-changeit}"
ENV SASL_USERNAME="${KAFKA_SASL_BROKER_ADMIN_USERNAME:-broker-admin}"
ENV SASL_PASSWORD="${KAFKA_SASL_BROKER_ADMIN_PASSWORD:-p4ssw0rd}"
RUN mkdir ${TLS_DIR}
RUN mkdir -p ${DESTINATION_APP_TARGET}
COPY certificate-authority ${TLS_DIR}
COPY docker-entrypoint.sh ${HOME}
COPY requirements.txt  ${DESTINATION_APP_TARGET}
COPY ${SCRIPT_NAME} ${DESTINATION_APP_TARGET}
RUN pip install --no-cache-dir -r ${DESTINATION_APP_TARGET}/requirements.txt
ENTRYPOINT ["sh", "docker-entrypoint.sh"]
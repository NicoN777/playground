FROM eclipse-temurin:17
ARG DOCKER_HOST_IP
ARG APP_NAME=user-registration
ARG APP_VERSION=0.0.1-SNAPSHOT
ARG APP_JAR=${APP_NAME}-$APP_VERSION.jar
ARG DESTINATION_APP_TARGET=/opt/app
ARG SOURCE_APP_JAR=./target/$APP_JAR
ENV TLS_DIR="${HOME}"/tls
ENV DOCKER_HOST_IP=$DOCKER_HOST_IP
ENV BOOTSTRAP_SERVERS=kafka-broker-1:9092
ENV REPLICATION_FACTOR=3
ENV APPLICATION_ID=docker-${APP_NAME}
ENV SSL_KEYSTORE_PASS="${SSL_KEYSTORE_PASS:-changeit}"
ENV SSL_KEY_PASS="${SSL_KEYSTORE_PASS:-changeit}"
ENV SSL_TRUSTSTORE_PASS="${SSL_TRUSTSTORE_PASS:-changeit}"
ENV SASL_BROKER_ADMIN_USERNAME="${KAFKA_SASL_BROKER_ADMIN_USERNAME:-broker-admin}"
ENV SASL_BROKER_ADMIN_PASS="${KAFKA_SASL_BROKER_ADMIN_PASSWORD:-p4ssw0rd}"
ENV EXECUTABLE_JAR=${DESTINATION_APP_TARGET}/${APP_JAR}
RUN mkdir ${DESTINATION_APP_TARGET} ${TLS_DIR}
COPY ${SOURCE_APP_JAR} ${DESTINATION_APP_TARGET}
COPY certificate-authority ${TLS_DIR}
COPY docker-entrypoint.sh ${HOME}
ENTRYPOINT ["sh", "docker-entrypoint.sh"]
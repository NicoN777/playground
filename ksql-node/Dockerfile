FROM toastyboii/base-ol9-node:v0.0.1
ARG DOCKER_HOST_IP
ARG KSQL_USER=ksqldb
ARG DOCKER_HOST_IP
ARG KSQL_USER_UID=1000
ARG KSQL_USER_HOME=/home/$KSQL_USER
ENV DOCKER_HOST_IP=$DOCKER_HOST_IP
ENV TLS_DIR="${KSQL_USER_HOME}"/tls
ENV KSQL_CONF_DIR=/etc/ksqldb
ENV SSL_KEYSTORE_PASS="${KSQL_KEYSTORE_PASS:-changeit}"
ENV SSL_TRUSTSTORE_PASS="${KSQL_TRUSTSTORE_PASS:-changeit}"
ENV KSQLDB_REPO=/etc/yum.repos.d/ksqldb.repo
ENV SASL_USERNAME="${SASL_USERNAME:-KSQL}"
ENV SASL_PASSWORD="${SASL_PASSWORD:-idk}"
ENV KSQL_OUTPUT_TOPIC_NAME_PREFIX=${KSQL_OUTPUT_TOPIC_NAME_PREFIX:-ksql-interactive-}
COPY user.sh /tmp
RUN sh /tmp/user.sh $KSQL_USER $KSQL_USER_UID
RUN touch $KSQLDB_REPO
RUN chown ${KSQL_USER_UID}:${KSQL_USER_UID} ${KSQLDB_REPO}
USER $KSQL_USER
WORKDIR $KSQL_USER_HOME
COPY --chown=${KSQL_USER_UID}:${KSQL_USER_UID} install.sh $KSQL_USER_HOME
RUN sh install.sh
COPY --chown=${KSQL_USER_UID}:${KSQL_USER_UID} certificate-authority ${TLS_DIR}
COPY --chown=${KSQL_USER_UID}:${KSQL_USER_UID} docker-entrypoint.sh ${KSQL_USER_HOME}
RUN chmod -x docker-entrypoint.sh
ENTRYPOINT ["sh", "docker-entrypoint.sh"]